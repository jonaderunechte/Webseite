<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Code Runner</title>
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (über CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel für JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>

  <body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useRef } = React;
      const { Play, Download, Settings, Bug, Code, Eye, Package, Cpu, Terminal } = lucide;

      function CodeRunner() {
        const [code, setCode] = useState(`// Willkommen zum Advanced Code Runner!\nconsole.log("Hello World!");`);
        const [language, setLanguage] = useState('javascript');
        const [output, setOutput] = useState('');
        const [libraries, setLibraries] = useState([]);
        const [newLibrary, setNewLibrary] = useState('');
        const [debugMode, setDebugMode] = useState(false);
        const [showSettings, setShowSettings] = useState(false);
        const [theme, setTheme] = useState('dark');
        const [fontSize, setFontSize] = useState(14);
        const iframeRef = useRef(null);

        const languageExamples = {
          javascript: `console.log("Hello from JavaScript!");`,
          python: `# Python Beispiel\nprint("Hello from Python!")`,
          html: `<!DOCTYPE html><html><body><h1>Hello HTML</h1></body></html>`,
          css: `body { background: #222; color: white; text-align: center; }`,
          arduino: `// Arduino Beispiel\nvoid setup() { Serial.begin(9600); }`
        };

        const executeCode = () => {
          setOutput('');
          try {
            if (language === 'javascript') {
              const logs = [];
              const oldLog = console.log;
              console.log = (...args) => logs.push(args.join(' '));
              try {
                eval(code);
              } catch (err) {
                logs.push('Error: ' + err.message);
              }
              console.log = oldLog;
              setOutput(logs.join('\n'));
            } else if (language === 'html' || language === 'css') {
              const iframe = iframeRef.current;
              if (iframe) {
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                doc.open();
                doc.write(language === 'html' ? code : `<style>${code}</style><div>Hello CSS Preview</div>`);
                doc.close();
              }
            } else {
              setOutput('Diese Sprache wird nur simuliert.');
            }
          } catch (error) {
            setOutput('Error: ' + error.message);
          }
        };

        const downloadCode = () => {
          const ext = { javascript: 'js', python: 'py', html: 'html', css: 'css', arduino: 'ino' }[language];
          const blob = new Blob([code], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `code.${ext}`;
          a.click();
          URL.revokeObjectURL(url);
        };

        const addLibrary = () => {
          if (newLibrary && !libraries.includes(newLibrary)) {
            setLibraries([...libraries, newLibrary]);
            setNewLibrary('');
          }
        };

        const loadExample = (lang) => {
          setLanguage(lang);
          setCode(languageExamples[lang]);
        };

        const isVisualLanguage = ['html', 'css'].includes(language);

        return (
          <div className={`h-screen flex flex-col ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'}`}>
            <div className="p-4 flex items-center justify-between border-b border-gray-700">
              <div className="flex items-center gap-2">
                <Code className="text-blue-400" />
                <h1 className="text-xl text-white font-bold">Advanced Code Runner</h1>
              </div>
              <div className="flex gap-2">
                <select
                  value={language}
                  onChange={(e) => loadExample(e.target.value)}
                  className="rounded px-2 py-1 bg-gray-700 text-white"
                >
                  <option value="javascript">JavaScript</option>
                  <option value="python">Python</option>
                  <option value="html">HTML</option>
                  <option value="css">CSS</option>
                  <option value="arduino">Arduino</option>
                </select>
                <button onClick={executeCode} className="bg-green-600 px-4 py-1 rounded text-white flex items-center gap-1">
                  <Play className="w-4 h-4" /> Run
                </button>
                <button onClick={downloadCode} className="bg-gray-700 px-3 py-1 rounded text-white">
                  <Download className="w-4 h-4" />
                </button>
              </div>
            </div>

            <div className="flex flex-1">
              <textarea
                value={code}
                onChange={(e) => setCode(e.target.value)}
                style={{ fontSize }}
                className="w-1/2 p-3 font-mono bg-gray-800 text-white border-r border-gray-700 resize-none outline-none"
              />
              <div className="w-1/2 flex flex-col">
                <div className="p-2 bg-gray-700 text-gray-300 text-sm flex items-center gap-2 border-b border-gray-600">
                  <Eye className="w-4 h-4" /> {isVisualLanguage ? 'Live Preview' : 'Console Output'}
                </div>
                {isVisualLanguage ? (
                  <iframe ref={iframeRef} title="preview" className="flex-1 border-0 bg-white" sandbox="allow-scripts"></iframe>
                ) : (
                  <pre className="flex-1 bg-black text-green-400 p-3 overflow-auto">
                    {output || 'Run your code to see output...'}
                  </pre>
                )}
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<CodeRunner />);
    </script>
  </body>
</html>
