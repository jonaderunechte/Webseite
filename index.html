<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Online Code Runner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            height: 100%;
            overflow: hidden;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .code-editor {
            font-family: 'Courier New', monospace;
            tab-size: 4;
        }
        textarea {
            outline: none;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="app"></div>

    <script>
        const state = {
            code: `// Willkommen zum Advanced Code Runner!
// Wähle eine Sprache und beginne zu programmieren

console.log("Hello World!");`,
            language: 'javascript',
            output: '',
            libraries: [],
            newLibrary: '',
            debugMode: false,
            showSettings: false,
            theme: 'dark',
            fontSize: 14
        };

        const examples = {
            javascript: `// JavaScript Beispiel
console.log("Hello from JavaScript!");

// Funktion definieren
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log("Fibonacci(10):", fibonacci(10));`,
            
            python: `# Python Beispiel
print("Hello from Python!")

# Funktion definieren
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

print(f"Fibonacci(10): {fibonacci(10)}")`,
            
            html: `<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .card {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }
    button:hover {
      background: #764ba2;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Interactive HTML Demo</h1>
    <p id="counter">Clicks: 0</p>
    <button onclick="incrementCounter()">Click Me!</button>
  </div>
  
  <script>
    let count = 0;
    function incrementCounter() {
      count++;
      document.getElementById('counter').textContent = 'Clicks: ' + count;
    }
  <\/script>
</body>
</html>`,
            
            arduino: `// Arduino Beispiel - LED Blink
const int LED_PIN = 13;

void setup() {
  pinMode(LED_PIN, OUTPUT);
  Serial.begin(9600);
  Serial.println("Arduino Started!");
}

void loop() {
  digitalWrite(LED_PIN, HIGH);
  Serial.println("LED ON");
  delay(1000);
  
  digitalWrite(LED_PIN, LOW);
  Serial.println("LED OFF");
  delay(1000);
}`,
            
            css: `/* CSS Animations Demo */
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #1a1a2e;
  overflow: hidden;
}

.container {
  position: relative;
  width: 300px;
  height: 300px;
}

.circle {
  position: absolute;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  animation: orbit 3s infinite linear;
}

.circle:nth-child(1) {
  background: linear-gradient(135deg, #667eea, #764ba2);
  animation-delay: 0s;
}

.circle:nth-child(2) {
  background: linear-gradient(135deg, #f093fb, #f5576c);
  animation-delay: 1s;
}

.circle:nth-child(3) {
  background: linear-gradient(135deg, #4facfe, #00f2fe);
  animation-delay: 2s;
}

@keyframes orbit {
  from {
    transform: rotate(0deg) translateX(100px) rotate(0deg);
  }
  to {
    transform: rotate(360deg) translateX(100px) rotate(-360deg);
  }
}

.center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 50px;
  height: 50px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 0 30px rgba(255,255,255,0.5);
}`
        };

        function executeCode() {
            state.output = '';
            
            try {
                if (state.language === 'javascript') {
                    executeJavaScript();
                } else if (state.language === 'python') {
                    executePython();
                } else if (state.language === 'html') {
                    executeHTML();
                } else if (state.language === 'arduino') {
                    executeArduino();
                } else if (state.language === 'css') {
                    executeCSS();
                }
            } catch (error) {
                state.output = 'Error: ' + error.message;
            }
            
            updateOutput();
        }

        function executeJavaScript() {
            const logs = [];
            const oldLog = console.log;
            
            console.log = function() {
                logs.push(Array.from(arguments).join(' '));
            };
            
            try {
                if (state.debugMode) {
                    logs.push('=== DEBUG MODE ===');
                }
                
                const result = eval(state.code);
                if (result !== undefined) {
                    logs.push('Return: ' + result);
                }
            } catch (error) {
                logs.push('Error: ' + error.message);
            }
            
            console.log = oldLog;
            state.output = logs.join('\n');
        }

        function executePython() {
            const output = [];
            output.push('=== Python Simulation ===');
            output.push('');
            
            try {
                const matches = state.code.match(/print\([^)]+\)/g);
                if (matches) {
                    matches.forEach(match => {
                        let content = match.substring(6, match.length - 1);
                        content = content.replace(/["']/g, '');
                        output.push(content);
                    });
                }
            } catch (error) {
                output.push('Error: ' + error.message);
            }
            
            state.output = output.join('\n');
        }

        function executeHTML() {
            const iframe = document.getElementById('preview-frame');
            if (iframe) {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    doc.open();
                    doc.write(state.code);
                    doc.close();
                } catch (e) {
                    console.error('Error writing to iframe:', e);
                }
            }
        }

        function executeCSS() {
            const html = `<!DOCTYPE html>
<html>
<head>
<style>${state.code}</style>
</head>
<body>
<div class="container">
<div class="circle"></div>
<div class="circle"></div>
<div class="circle"></div>
<div class="center"></div>
</div>
</body>
</html>`;
            
            const iframe = document.getElementById('preview-frame');
            if (iframe) {
                try {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    doc.open();
                    doc.write(html);
                    doc.close();
                } catch (e) {
                    console.error('Error writing to iframe:', e);
                }
            }
        }

        function executeArduino() {
            const output = [];
            output.push('=== Arduino Simulator ===');
            output.push('Board: Arduino Uno');
            output.push('');
            
            const matches = state.code.match(/Serial\.println?\([^)]+\)/g);
            if (matches) {
                output.push('Serial Monitor:');
                output.push('---');
                matches.forEach(match => {
                    let content = match.match(/Serial\.println?\(([^)]+)\)/)[1];
                    content = content.replace(/["']/g, '');
                    output.push(content);
                });
            }
            
            output.push('');
            output.push('✓ Compilation successful');
            output.push('✓ Upload complete');
            
            state.output = output.join('\n');
        }

        function downloadCode() {
            const extensions = {
                javascript: 'js',
                python: 'py',
                html: 'html',
                arduino: 'ino',
                css: 'css'
            };
            
            const blob = new Blob([state.code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'code.' + extensions[state.language];
            a.click();
            URL.revokeObjectURL(url);
        }

        function addLibrary() {
            if (state.newLibrary && !state.libraries.includes(state.newLibrary)) {
                state.libraries.push(state.newLibrary);
                state.newLibrary = '';
                render();
            }
        }

        function removeLibrary(index) {
            state.libraries.splice(index, 1);
            render();
        }

        function loadExample(lang) {
            state.language = lang;
            state.code = examples[lang];
            render();
        }

        function updateOutput() {
            const el = document.getElementById('console-output');
            if (el) {
                el.textContent = state.output || 'Run your code to see output...';
            }
        }

        function render() {
            const isVisual = state.language === 'html' || state.language === 'css';
            
            const html = `
                <div class="h-screen flex flex-col overflow-hidden">
                    <!-- Header -->
                    <div class="bg-gray-800 border-b border-gray-700 p-4 flex-shrink-0">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                </svg>
                                <h1 class="text-2xl font-bold text-white">Advanced Code Runner</h1>
                            </div>
                            
                            <div class="flex items-center gap-3">
                                <select id="lang-select" class="px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600">
                                    <option value="javascript" ${state.language === 'javascript' ? 'selected' : ''}>JavaScript</option>
                                    <option value="python" ${state.language === 'python' ? 'selected' : ''}>Python</option>
                                    <option value="html" ${state.language === 'html' ? 'selected' : ''}>HTML</option>
                                    <option value="css" ${state.language === 'css' ? 'selected' : ''}>CSS</option>
                                    <option value="arduino" ${state.language === 'arduino' ? 'selected' : ''}>Arduino</option>
                                </select>
                                
                                <button id="run-btn" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                    Run
                                </button>
                                
                                <button id="debug-btn" class="flex items-center gap-2 px-4 py-2 rounded-lg transition ${state.debugMode ? 'bg-orange-600 text-white' : 'bg-gray-700 text-white'}">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Debug
                                </button>
                                
                                <button id="download-btn" class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                    </svg>
                                    Download
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex flex-1 overflow-hidden">
                        <!-- Left Side -->
                        <div class="w-1/2 flex flex-col bg-gray-800 border-r border-gray-700">
                            <div class="p-3 bg-gray-700 border-b border-gray-600 flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-300">Code Editor</span>
                                ${state.debugMode ? '<span class="text-xs bg-orange-500 text-white px-2 py-1 rounded">DEBUG</span>' : ''}
                            </div>
                            
                            <textarea id="code-input" class="flex-1 p-4 code-editor resize-none bg-gray-900 text-gray-100 overflow-auto" style="font-size: ${state.fontSize}px" spellcheck="false">${state.code}</textarea>
                            
                            <div class="p-3 bg-gray-700 border-t border-gray-600">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-sm font-medium text-gray-300">Libraries</span>
                                </div>
                                <div class="flex gap-2">
                                    <input id="lib-input" type="text" placeholder="CDN URL" class="flex-1 px-3 py-1 text-sm rounded bg-gray-600 text-white border border-gray-500"/>
                                    <button id="add-lib-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded text-sm">Add</button>
                                </div>
                                <div class="mt-2 flex flex-wrap gap-2">
                                    ${state.libraries.map((lib, i) => `
                                        <div class="flex items-center gap-1 bg-gray-600 px-2 py-1 rounded text-xs">
                                            <span class="text-gray-300">${lib.substring(0, 30)}...</span>
                                            <button onclick="removeLibrary(${i})" class="text-red-500 hover:text-red-700 ml-1">×</button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- Right Side -->
                        <div class="w-1/2 flex flex-col bg-gray-800 overflow-hidden">
                            <div class="p-3 bg-gray-700 border-b border-gray-600">
                                <span class="text-sm font-medium text-gray-300">${isVisual ? 'Live Preview' : 'Console Output'}</span>
                            </div>
                            
                            ${isVisual ? 
                                '<iframe id="preview-frame" class="flex-1 w-full border-0 bg-white" sandbox="allow-scripts allow-same-origin"></iframe>' :
                                '<pre id="console-output" class="flex-1 p-4 code-editor text-sm overflow-auto bg-gray-900 text-green-400">Run your code to see output...</pre>'
                            }
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('app').innerHTML = html;
            attachEvents();
        }

        function attachEvents() {
            document.getElementById('run-btn').onclick = executeCode;
            document.getElementById('download-btn').onclick = downloadCode;
            document.getElementById('debug-btn').onclick = function() {
                state.debugMode = !state.debugMode;
                render();
            };
            document.getElementById('lang-select').onchange = function(e) {
                loadExample(e.target.value);
            };
            document.getElementById('code-input').oninput = function(e) {
                state.code = e.target.value;
            };
            document.getElementById('add-lib-btn').onclick = function() {
                state.newLibrary = document.getElementById('lib-input').value;
                addLibrary();
            };
            document.getElementById('lib-input').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    state.newLibrary = e.target.value;
                    addLibrary();
                }
            };
        }

        window.onload = function() {
            render();
        };
    </script>
</body>
</html>
